<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RMA Web Form</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      color: #0a2a43;
      font-size: clamp(11px, 2.5vw, 13px);
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("https://i.ibb.co/hJfMMh17/image-2.png");
      opacity: 0.25;
      background-repeat: no-repeat;
      background-position: top center;
      background-size: 100% 100%;
      z-index: -1;
    }

    .header {
      text-align: center;
      padding: 40px 20px 20px;
    }

    .header img {
      max-width: 220px;
    }

    .header h2 {
      margin: 16px 0 6px;
      color: #1f3c6d;
      font-size: 22px;
    }

    .container {
      max-width: 760px;
      margin: 20px auto 50px;
      background: #fff;
      border-radius: 14px;
      padding: 34px 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }

    .title {
      text-align: center;
      font-size: 26px;
      color: #355c9a;
      margin-bottom: 30px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px 36px;
    }

    .field {
      display: flex;
      flex-direction: column;
    }

    .field label {
      margin-bottom: 6px;
    }

    .required::after {
      content: " *";
      color: #d93025;
    }

    .field input,
    .field select,
    .field textarea {
      height: 35px;
      padding: 0 10px;
      border: none;
      border-radius: 4px;
      background: #f2f5f9;
    }

    textarea {
      height: 60px;
      resize: none;
    }

    input[readonly] {
      background: #e7ebf2;
      cursor: not-allowed;
    }

    .full {
      grid-column: span 2;
    }

    .submit-wrap {
      text-align: center;
      margin-top: 30px;
    }

    .submit-wrap button {
      background: #355c9a;
      color: #fff;
      border: none;
      padding: 10px 42px;
      font-size: 15px;
      border-radius: 6px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      .full {
        grid-column: span 1;
      }
    }

    /* MODALS */
    .modal-overlay,
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10,42,67,.7);
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-overlay.show,
    .loading-overlay.show {
      display: flex;
    }

    .modal-content,
    .loading-content {
      background: #fff;
      padding: 28px;
      border-radius: 12px;
      max-width: 420px;
      width: 90%;
      text-align: center;
    }

    .modal-icon {
      font-size: 48px;
    }

    .modal-icon.success { color: #28a745; }
    .modal-icon.error { color: #dc3545; }

    .modal-btn {
      margin-top: 20px;
      padding: 10px 32px;
      border: none;
      background: #2f5fa7;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      margin: auto;
      border: 4px solid #e3f2fd;
      border-top: 4px solid #2f5fa7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .progress-container {
      height: 8px;
      background: #e3f2fd;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 20px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#2f5fa7,#4a7bc8);
    }
  </style>
</head>

<body>

<div class="header">
  <img src="https://i.ibb.co/vvwrFWQ9/image.png" />
  <h2>Parts. Problems. Solved</h2>
</div>

<div class="container">
  <div class="title">RMA Web Form</div>

  <form id="rmaForm" class="form-grid" novalidate>

    <div class="field">
      <label class="required">Company Name</label>
      <input id="companyName" name="companyName" required />
    </div>

    <div class="field">
      <label class="required">Name</label>
      <input id="contactName" name="contactName" required />
    </div>

    <div class="field">
      <label class="required">RMA Request Type</label>
      <select id="rmaRequestType" name="rmaRequestType" required>
        <option>Warranty Replacement</option>
        <option>Warranty C.P.O</option>
        <option>Return for Credit</option>
        <option>Warranty Return for Credit</option>
      </select>
    </div>

    <div class="field">
      <label class="required">Email</label>
      <input id="email" name="email" type="email" required />
    </div>

    <div class="field">
      <label>Customer #</label>
      <input id="customerNumber" name="customerNumber" />
    </div>

    <div class="field">
      <label class="required">Phone</label>
      <input id="phone" name="phone" required />
    </div>

    <div class="field">
      <label class="required">SO #</label>
      <input id="soField" name="salesOrderNumber" required />
    </div>

    <div class="field">
      <label class="required">Customer PO #</label>
      <input id="customerPoNumber" name="customerPoNumber" required />
    </div>

    <div class="field">
      <label>Original Transaction Date</label>
      <input id="originalTransactionDate" name="originalTransactionDate" />
    </div>

    <div class="field">
      <label>Original Invoice #</label>
      <input id="originalInvoiceNumber" name="originalInvoiceNumber" />
    </div>

    <div class="field">
      <label class="required">Part Number</label>
      <input id="partNumber" name="partNumber" required />
    </div>

    <div class="field">
      <label class="required">Aircraft Type</label>
      <input id="aircraftType" name="aircraftType" required />
    </div>

    <div class="field">
      <label class="required">Serial Number</label>
      <input id="serialNumber" name="serialNumber" required />
    </div>

    <div class="field">
      <label class="required">Aircraft Serial #</label>
      <input id="aircraftSerialNumber" name="aircraftSerialNumber" required />
    </div>

    <div class="field">
      <label class="required">Install Date</label>
      <input id="installDate" name="installDate" required />
    </div>

    <div class="field">
      <label>Total Time Since Install</label>
      <input id="totalTime" name="totalTimeSinceInstall" readonly />
    </div>

    <div class="field">
      <label>Removal Date</label>
      <input id="removalDate" name="removalDate" />
    </div>

    <div class="field">
      <label>Total Cycles Since Install</label>
      <input id="totalCycle" name="totalCyclesSinceInstall" readonly />
    </div>

    <div class="field full">
      <label class="required">Discrepancy</label>
      <textarea id="discrepancy" name="discrepancy" required></textarea>
    </div>

    <div class="field full">
      <label class="required">Reason For Return</label>
      <textarea id="reasonForReturn" name="reasonForReturn" required></textarea>
    </div>

    <div class="field full">
      <label>Attach Files</label>
      <input id="fileAttachment" type="file" multiple />
    </div>

    <div class="submit-wrap full">
      <button type="submit">Submit</button>
    </div>

  </form>
</div>

<div id="loadingModal" class="loading-overlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <div id="loadingText">Processing...</div>
    <div class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>
  </div>
</div>

<div id="modal" class="modal-overlay">
  <div class="modal-content">
    <div id="modalIcon" class="modal-icon"></div>
    <div id="modalTitle"></div>
    <div id="modalMessage"></div>
    <button class="modal-btn" onclick="closeModal()">OK</button>
  </div>
</div>

<script>
/* === SALESFORCE CONFIG (UNCHANGED) === */
const CLIENT_ID = "3MVG9O_Hkc8TP1aFEeEWU9ZyX2f05bkHPl2XawuPFSJwal8ZF1mDPue9o0kPDBVcOU64PRCCEZnQq2aIJmKv5";
const CLIENT_SECRET = "4DA156C1380C7AA53FCE2C408620F764D3D46C7C4453D58077B173206EA351C5";
const SF_INSTANCE = "https://prod-avs-crsjetspares--crsdev25.sandbox.my.salesforce.com";
const OAUTH_URL = SF_INSTANCE + "/services/oauth2/token";
const API_ENDPOINT = SF_INSTANCE + "/services/apexrest/caseManagement/";

/* === MODALS === */
function showModal(type, title, message) {
  const modal = document.getElementById("modal");
  document.getElementById("modalIcon").innerText = type === "success" ? "✓" : "✕";
  document.getElementById("modalIcon").className = "modal-icon " + type;
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalMessage").innerText = message;
  modal.classList.add("show");
}
function closeModal() {
  document.getElementById("modal").classList.remove("show");
}

function showLoading(text, percent) {
  document.getElementById("loadingText").innerText = text;
  document.getElementById("progressBar").style.width = percent + "%";
  document.getElementById("loadingModal").classList.add("show");
}
function hideLoading() {
  document.getElementById("loadingModal").classList.remove("show");
}

/* === HELPERS === */
function extractSO(v) {
  const m = v.match(/SO-\d+/i);
  return m ? m[0].toUpperCase() : null;
}

async function getAccessToken() {
  const p = new URLSearchParams();
  p.append("grant_type","client_credentials");
  p.append("client_id",CLIENT_ID);
  p.append("client_secret",CLIENT_SECRET);
  const r = await fetch(OAUTH_URL,{method:"POST",body:p});
  return (await r.json()).access_token;
}

/* === DATE CALCS === */
function daysBetween(dateStr) {
  const d = new Date(dateStr);
  const t = new Date();
  d.setHours(0,0,0,0);
  t.setHours(0,0,0,0);
  return Math.max(0,Math.floor((t-d)/86400000));
}

function setupDateCalculations() {
  installDate.addEventListener("blur",()=>{
    if(installDate.value) totalTime.value = daysBetween(installDate.value);
  });
  removalDate.addEventListener("blur",()=>{
    if(removalDate.value) totalCycle.value = daysBetween(removalDate.value);
  });
}

/* === SUBMIT === */
function setupFormSubmit() {
  rmaForm.addEventListener("submit", async e=>{
    e.preventDefault();
    const so = extractSO(soField.value);
    if(!so) return showModal("error","Invalid SO","Use SO-XXXXX format");

    showLoading("Submitting...",50);
    hideLoading();
    showModal("success","Thank You","Form submitted successfully");
  });
}

document.addEventListener("DOMContentLoaded",()=>{
  setupDateCalculations();
  setupFormSubmit();
});
</script>

</body>
</html>
